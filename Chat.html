<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Realtime Private Chat</title>

<style>
body{
    margin:0;
    font-family:Arial;
    height:100vh;
    display:flex;
    flex-direction:column;
    background:#111;
    background-size:cover;
    background-position:center;
}

/* TOP BAR */
.topbar{
    display:flex;
    align-items:center;
    gap:8px;
    padding:8px;
    background:#00000080;
    color:white;
}

/* CHAT AREA */
.chat{
    flex:1;
    overflow-y:auto;
    padding:10px;
    display:flex;
    flex-direction:column;
}

/* MESSAGE BUBBLES */
.msg{
    padding:8px 12px;
    margin:5px 0;
    max-width:70%;
    border-radius:14px;
    word-wrap:break-word;
    color:white;
}

/* CHANGE COLORS HERE */
.me{ background:#25D366; align-self:flex-end; }
.other{ background:#0084ff; align-self:flex-start; }

.msg img, .msg video{
    max-width:200px;
    border-radius:10px;
}

/* BOTTOM INPUT */
.bottom{
    display:flex;
    gap:5px;
    padding:6px;
    background:white;
}

.bottom input[type=text]{
    flex:1;
    padding:10px;
    font-size:16px;
}
button{
    padding:8px 10px;
    cursor:pointer;
}
</style>
</head>
<body>

<div class="topbar">
    Background:
    <input type="file" id="bgUpload" accept="image/*">
</div>

<div id="chat" class="chat"></div>

<div class="bottom">
    <input id="msgInput" placeholder="Type message...">
    <input type="file" id="fileInput" accept="image/*,video/*">
    <button onclick="sendText()">Send</button>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

/* ===== 1️⃣ Firebase Config ===== */
const firebaseConfig = {
  apiKey: "PASTE",
  authDomain: "PASTE",
  databaseURL: "PASTE",
  projectId: "PASTE",
  storageBucket: "PASTE",
  messagingSenderId: "PASTE",
  appId: "PASTE"
};

/* ===== 2️⃣ Initialize Firebase ===== */
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ===== HTML ELEMENTS ===== */
const chat = document.getElementById("chat");
const msgInput = document.getElementById("msgInput");
const fileInput = document.getElementById("fileInput");
const bgUpload = document.getElementById("bgUpload");

/* ===== SEND TEXT ===== */
function sendText(){
    const text = msgInput.value.trim();
    if(!text) return;

    // Push to Firebase
    push(ref(db, 'messages'), {
        type: 'text',
        content: text,
        sender: 'me', // can change to unique id per user
        timestamp: Date.now()
    });

    msgInput.value='';
}

/* ===== SEND IMAGE/VIDEO ===== */
fileInput.onchange = function(){
    const file = this.files[0];
    if(!file) return;
    const url = URL.createObjectURL(file);

    let type = file.type.startsWith('image') ? 'image' : 'video';
    push(ref(db, 'messages'), {
        type: type,
        content: url,
        sender: 'me',
        timestamp: Date.now()
    });
};

/* ===== LISTEN TO MESSAGES ===== */
const messagesRef = ref(db, 'messages');
onChildAdded(messagesRef, (data) => {
    const msg = data.val();
    addMessage(msg);
});

/* ===== ADD MESSAGE TO CHAT ===== */
function addMessage(msg){
    const div = document.createElement('div');
    div.className = 'msg ' + (msg.sender==='me' ? 'me' : 'other');

    if(msg.type === 'text'){
        div.innerText = msg.content;
    } else if(msg.type === 'image'){
        const img = new Image();
        img.src = msg.content;
        div.appendChild(img);
    } else if(msg.type === 'video'){
        const v = document.createElement('video');
        v.src = msg.content;
        v.controls = true;
        div.appendChild(v);
    }

    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

/* ===== BACKGROUND CHANGE ===== */
bgUpload.onchange = function(){
    const file = this.files[0];
    document.body.style.backgroundImage = "url(" + URL.createObjectURL(file) + ")";
}

/* ===== ENTER KEY SEND ===== */
msgInput.addEventListener('keydown', e => {
    if(e.key==='Enter') sendText();
});
</script>

</body>
</html>
